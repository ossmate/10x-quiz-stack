---
import ManagementLayout from "../../layouts/ManagementLayout.astro";
import { Breadcrumbs } from "../../components/management/Breadcrumbs";
import { QuizCreator } from "../../components/quizzes/QuizCreator";
import { Toaster } from "../../components/ui/sonner";
import type { BreadcrumbItem } from "../../types/management.types";

// Set prerender to false as this page requires authentication
export const prerender = false;

// Get authenticated user from middleware
const user = Astro.locals.user;

// Redirect to login if not authenticated (middleware should handle this, but double-check)
if (!user) {
  return Astro.redirect(`/auth/login?redirect=${encodeURIComponent("/quizzes/new")}`);
}

// Define breadcrumbs
const breadcrumbs: BreadcrumbItem[] = [
  { label: "Dashboard", path: "/" },
  { label: "Create Quiz", path: "/quizzes/new", isCurrent: true },
];
---

<ManagementLayout title="Create New Quiz">
  <Breadcrumbs client:load items={breadcrumbs} />

  <div class="mb-6">
    <h1 class="text-3xl font-bold text-foreground">Create New Quiz</h1>
    <p class="text-muted-foreground mt-2">Manually create a quiz by adding questions and answers</p>
  </div>

  <!-- Quiz Creator Component -->
  <QuizCreator client:only="react" userId={user.id} />

  <!-- Toast Notifications -->
  <Toaster client:only="react" />
</ManagementLayout>
