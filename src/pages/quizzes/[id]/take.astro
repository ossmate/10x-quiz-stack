---
import Layout from "../../../layouts/Layout.astro";
import { QuizTakingContainer } from "../../../components/quiz-taking/QuizTakingContainer.tsx";
import { getDemoQuizById } from "../../../data/demoQuizzes";

// Set prerender to false as this page requires authentication
export const prerender = false;

// Extract quiz ID from route parameters
const { id } = Astro.params;

// Ensure quiz ID exists
if (!id) {
  return Astro.redirect("/");
}

// Check if this is a demo quiz
const isDemo = id.startsWith("demo-");

// For demo quizzes, verify the quiz exists
if (isDemo) {
  const demoQuiz = getDemoQuizById(id);
  if (!demoQuiz) {
    return Astro.redirect("/404");
  }
}

// Get user - demo quizzes don't require authentication
const currentUserId = Astro.locals.user?.id || null;
---

<Layout title={isDemo ? "Demo Quiz | QuizStack" : "Take Quiz | QuizStack"}>
  <QuizTakingContainer client:load quizId={id} currentUserId={currentUserId} isDemo={isDemo} />
</Layout>
